# 软件需求规格说明书 (Software Requirements Specification - SRS)

## 1. 引言
### 1.1 编写目的
本文档旨在详细说明“视觉语义 RAG 系统”的功能需求、非功能需求及系统约束，为开发、测试和后续维护提供标准依据。

### 1.2 项目背景
在垂直领域（如民航、法律、医疗）的知识库建设中，大量核心知识以复杂 PDF 格式存在。传统 RAG 系统在处理扫描件、多级标题和表格时表现不佳，本系统旨在通过视觉解析技术提升知识召回的精确度。

## 2. 任务概述
### 2.1 目标
构建一个具备“视觉感知”能力的 RAG 系统，能够识别文档物理结构并将其转化为具备层级语义的向量块。

### 2.2 用户特征
- **文档管理员**：负责知识库入库，需要高精度的解析工具。
- **普通用户**：通过自然语言提问获取专业知识，需要准确、带溯源的答案。
- **系统管理员/开发人员**：负责模型调优与系统维护。

## 3. 功能需求

### 3.1 PDF 解析与视觉增强 (FR-01)
- **OCR 支持**：系统必须支持对扫描 PDF 进行文字识别。
- **图像预处理**：必须包含灰度化、中值滤波和 OTSU 二值化等图像增强功能。
- **结构识别**：必须能够根据字体大小、加粗等特征识别一级标题 (H1) 和二级标题 (H2)。

### 3.2 语义清洗与修复 (FR-02)
- **LLM 修复**：必须能够调用大模型对 OCR 产生的破碎文本进行拼写检查、断句修复和 Markdown 格式化。
- **物理合并**：系统应根据坐标信息自动合并同一物理行内的文本块。

### 3.3 知识库构建 (FR-03)
- **结构感知切片**：在文本切片时，必须将所属的 H1/H2 路径作为元数据注入。
- **向量化**：支持 BGE-M3 嵌入模型，将文本块转化为 1024 维向量。
- **持久化存储**：使用 SQLite 存储原文、向量 BLOB 和元数据。

### 3.4 检索与生成 (FR-04)
- **Query 重写**：支持将用户简短提问重写为更丰富的检索词。
- **多路重排**：支持向量检索后再经过 Reranker 模型进行精排。
- **可追溯性**：生成的答案必须指明参考资料的来源文档及页码。

## 4. 非功能需求

### 4.1 性能需求 (NFR-01)
- **响应时间**：简单的向量检索响应时间应 < 500ms。
- **并发能力**：向量化入库阶段应支持多线程并行处理（2-10 线程可调）。

### 4.2 可靠性需求 (NFR-02)
- **异常处理**：网络请求失败时应具备至少 3 次自动重试机制。
- **数据一致性**：必须确保向量库与 JSON 备份文件的一致性。

### 4.3 易用性需求 (NFR-03)
- **可视化界面**：提供 GUI 工具供用户监控解析进度和查看检索日志。

## 5. 运行环境
- **操作系统**：Windows 10/11 (主要适配), Linux (兼容 API 模式)。
- **硬件要求**：建议 16G RAM 以上，如运行本地模型需 NVIDIA GPU。
- **第三方依赖**：Tesseract-OCR 引擎。
